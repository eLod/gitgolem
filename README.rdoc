= Golem

Golem provides an easy way to host and manage access to git repositories on a server under a single user.

== How it works

Golem's main goals are:

* host git repositories under a single user,
* manage access to repositories on a per-user basis,
* store users and keys in a database,
* to be simple as possible, but still extendable.

Golem is not designed to handle complex access rules, altough it may be extended to achieve that. If you need more refined rules, like per-branch or per-path control
you should check out {https://github.com/sitaramc/gitolite gitolite}, which has far superior features in this regard.

The git flow that golem supports is:

* you have a specific shell user that "hosts" golem,
* golem places your users ssh keys in this (shell) user's home directory (~/.ssh/authorized_keys),
* your users use a git remote like golem_host_user@your_server:repository.git,
* when a user git pushes/pulls, his git connects via ssh, sshd invokes golem's authorization command (via the authorized_keys file),
* golem authorizes the user for the given repository and invokes git-shell if access granted.

== Configuration

Golem supports the following configuration variables:

* +db+: the database to use, currently postgres ('postgres://...') and static ('static') supported
* +user_home+: the directory where the .ssh/authorized_keys file should be written, defaults to HOME environment variable
* +repository_dir+: path to the git repositories, may be relative to +user_home+
* +cfg_path+: path to config file, if not set searched for as (in this order)
  * GOLEM_CONFIG environment variable (if set)
  * 'golem.conf.rb' relative to GOLEM_BASE environment variable (if set)
  * /usr/local/etc/golem.conf.rb
  * /etc/golem.conf.rb
  * ~/golem.conf.rb
  * if none found, it is set to +base_dir+ + "/golem.conf.rb" after configuration
* +base_dir+: convenience feature, may be used to store installation, if not explicitly set defaults to
  * GOLEM_BASE environment variable (if set)
  * basedir of +cfg_path+ if file exists
  * basedir of the library itself (e.g. the gem path)
* +bin_dir+: where the executable is installed, defaults to +base_dir+ + "/bin"
* +hooks_dir+: where the hooks are installed, defaults to +base_dir+ + "/hooks"

== Database

Golem currently supports postgres and a static databases only, but it should be trivial to extend it (contributions are always welcome).

The static database is suitable for small installations (where an rdbms would be an overkill), to use it simply write:

  Golem.configure do |cfg|
    cfg.db = 'static'
    Golem::DB.setup do |db|
      db.add_user 'test_user'
      db.add_repository 'test_repository', 'test_user'
      db.add_key 'test_user', 'test_key'
    end
  end

The postgres database stores data in 3 tables (users, repositories, keys), and can be used with setting the db variable to the postgres url (e.g. +postgres://user:pw@host/db+).
A sample schema can be found in +lib/golem/db/postgres.sql+, and it is imported by {Golem::DB::Pg#setup} (please note: {Golem::DB.setup} forwards to it, should be called
only once).

At least users and repositories should have names, keys should have an attribute named +key+ that is the whole key (e.g. cat id_rsa.pub).

== Access control

Golem's access control by default is very simple. It assumes a repository belongs to a single user, so it grants access to a given repository only to its owner.
For a very basic setup this should be enough. However for more complex setup Golem does not want to assume how you want to store your users and repositories, so
it simply doesn't. You can fine tune your environment to suit your specific needs with overriding {Golem::Access.check} (its arguments are the username, the repository
name and the git command to run (e.g. one of upload-pack, upload-archive and receive-pack)).

Golem's access control is done at the very beginning, before git-shell is run, so it's not suitable for per-branch or per-directory control. This can be achieved by hooks.
You should check out {https://github.com/sitaramc/gitolite gitolite}, which supports exactly that (and more). If you want you can place
{https://github.com/sitaramc/gitolite gitolite}'s hooks in Golem's hooks_dir and achieve the same results (this requires deeper understanding of git, so
please be aware).

== Commands

Golem provides an executable, and supports a few commands to easily automate the administration:

* auth: is used for authorization by sshd
* clear_repositories: clear old data (e.g. suitable for cron)
* create_repository: create a repository manually (new repositories are created on first access by golem)
* delete_repository: delete a repository manually
* environment: list configuration variables
* save_config: save configuration variables
* update_hooks: update hooks in every repository
* update_keys_file: update the .ssh/authorized_keys file

You can get details about commands running +golem -h+ or +--help+.

== Contributing to golem

* Check out the latest master to make sure the feature hasn't been implemented or the bug hasn't been fixed yet
* Check out the issue tracker to make sure someone already hasn't requested it and/or contributed it
* Fork the project
* Start a feature/bugfix branch
* Commit and push until you are happy with your contribution
* Make sure to add tests for it. This is important so I don't break it in a future version unintentionally.
* Please try not to mess with the Rakefile, version, or history. If you want to have your own version, or is otherwise necessary, that is fine, but please isolate to its own commit so I can cherry-pick around it.

== Copyright

Copyright (c) 2011 PoTa. See LICENSE.txt for
further details.

